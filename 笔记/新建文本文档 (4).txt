<template>
	<div class="register">
		<div class="register_header">
			<div class="back" @click="register_back"></div>
			<div class="center">手机注册</div>
			<div class="block"></div>
		</div>
		<div class="register_form">
			<div class="phoneNumber">
				<input type="text" name="" id="register_phone"  placeholder="输入常用手机号" v-model="phone_num"/>
			</div>
			<div class="yanZheng">
				<input type="text" id="register_yanZ"  placeholder="输入短信验证码" v-model="validateCode"/>
				<div class="get_code">
					<span v-show="show" @click="getCode">获取验证码</span>
					<span v-show="!show" class="count">约{{count}}s后获取</span>
				</div>
			
			</div>
			<div class="password">
				<!-- @blur="psw_Blur" -->
				<input type="password" name="" id="register_psw" value="" placeholder="设置6-15位字母/数字登录密码" v-model="psw"/> 
			</div>
			<div class="repassword">
				<input type="password" name="" id="register_repsw" value="" placeholder="请确认以上密码" v-model="r_psw" />
			</div>
			<div class="register_button submit_button" style="background:#c1c1c1;color:#545454;" @click="submit">注册有奖</div>
			<div class="register_button" style="background:#1479d1;color:#ffffff" @click="goLogin">已有账号，直接登录</div>

			<div class="err_num" v-show="isshow">{{err_content}}</div>
		
		</div>
		
	</div>
</template>

<script>

  export default {
  	name:'Register',
  	data(){
  		return {
  			show: true,
  			count: '',
			timer: null,
			phone_num:'',
			psw:'',
			r_psw:'',
			// 请输入正确值的弹框
			isshow:false,
			// 判断是否输入完整信息
			err_content:"",
			//短信验证码
			validateCode:""
  		}
  	},
  	methods:{		 
		  		//获取验证码
				getCode(){
					  //判断手机号是否输入正确
					 var myreg=/^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/;  
					if (!myreg.test(this.phone_num)) {  
						this.phone_num = this.phone_num.slice(0,11)
						this.isshow = true;
						var that = this;
						this.err_content="请输入正确的手机号码";
						 clearInterval(timer)
						var timer = setInterval(function(){
							that.isshow =false;
						},3000)
						clearInterval();
						return false;
					}else{
						//输入手机号正确，进行短信验证
						const baseUrl = this.$Regist_Msg+this.phone_num;
						console.log(baseUrl)
						this.$http({
						method:'get',
						url:baseUrl,
						  headers: {
							"Accept" : "*/*"
						  },
					}).then((response)=>{
						console.log(response)
						if(response.status == 200){
							return true;
						}
					}).catch((err)=>{
						console.log(err)
					})

						const TIME_COUNT = 60;
						if (!this.timer) {
						this.count = TIME_COUNT;
						this.show = false;
						this.timer = setInterval(() => {
						if (this.count > 0 && this.count <= TIME_COUNT) {
							this.count--;
							} else {
							this.show = true;
							clearInterval(this.timer);
							this.timer = null;
							}
						}, 1000)
						}
					}

				
			},
			//提交注册
			submit(){
				
				//输入内容不为空
				if(this.phone_num!=""&&this.r_psw!==""&&this.psw!==""&&this.validateCode!==""){
						//判断是否输入正确手机号
					var myreg=/^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/;  
					if (!myreg.test(this.phone_num)) {  
						this.phone_num = this.phone_num.slice(0,11)
						this.isshow = true;
						var that = this;
						this.err_content="请输入正确的手机号码";
						clearInterval(timer)
						var timer = setInterval(function(){
							that.isshow =false;
						},3000)
						clearInterval();
						return false;
					}
					//匹配6-15位密码
					var pswreg = /^[a-zA-Z0-9]{6,15}$/;
					if(!pswreg.test(this.psw)){
						this.isshow = true;						
						this.err_content="请输入正确的密码";
						clearInterval(timer);
						var that = this;
						var timer = setInterval(function(){
							that.isshow =false;
						},3000)
						clearInterval();
						return false;
					}
					//判断两次输入密码是否一致
					if(this.r_psw!==this.psw){
					this.isshow = true;
					var that = this;
					this.err_content="两次输入的密码不一致";
						clearInterval(timer);
						var timer = setInterval(function(){
							that.isshow =false;
						},3000)
						clearInterval();
						return false;
					}
					//短信验证码不为空
					if(this.validateCode==""){
						this.isshow = true;
						var that = this;
						this.err_content="短信验证码不能为空";
						clearInterval(timer);
						var timer = setInterval(function(){
							that.isshow =false;
						},3000)
						clearInterval();
						return false;
					}
					//输入内容正确，进行注册请求
					this.$http({
						method:'post',
						url:this.$Regist,
						 data:{
							password : this.psw,
							  phone : this.phone_num,
							  validateCode:this.validateCode
						 },
						  headers: {
							"Content-Type" : "application/json",
							"Accept" : "*/*"
						  },
					}).then((response)=>{
						console.log(response)
						if(response.status == 200){
							this.isshow = true;
							var that = this;
							this.err_content=response.data;
							clearInterval(timer);
							var timer = setInterval(function(){
								that.isshow =false;
							},3000)
							
							//注册成功后，提示信息2s后跳转登录页
							var timers = setInterval(function(){  
								if(response.data == "注册成功")  
								{  
									clearInterval(timers);  
									that.$router.push("/login")
								}  
							},2000);  

						}

					}).catch((err)=>{
						console.log(err)
					})
				
				}else{
					this.isshow = true;
						var that = this;
						this.err_content="请输入完整信息";
						clearInterval(timer);
						var timer = setInterval(function(){
							that.isshow =false;
						},3000)	
				}
			},
			goLogin(){
				this.$router.push('/login')
			},
			register_back(){
				this.$router.go(-1);
			}
		
	  },
	  updated () {
		if(this.phone_num!==""&&this.r_psw!==""&&this.psw!==""){
					 document.getElementsByClassName("submit_button")[0].style.background="#f94b4b";
					 document.getElementsByClassName("submit_button")[0].style.color="#ffffff";
		  }else{
			  document.getElementsByClassName("submit_button")[0].style.background="#c1c1c1";
		  }  
	  }
	  
  }
</script>

<style scoped>
.register{
  	width: 100%;
  	height: 100%;
  	background: #f8f8f8;
  }	
 .register .register_header{
  	width: 100%;
  	height: 4.03rem;
  	background: #f9e44b;
  	padding-top: 1.18rem;
  	padding-left: 0.62rem;
  	padding-right: 0.62rem;
  	box-sizing: border-box;
  	display: flex;
  	justify-content: space-between;
  }
 .register .register_header .back{
  	width: 0.62rem;
  	height: 100%;
  	background: url(../assets/back.png) no-repeat center center;
  	background-size: 0.62rem 1.28rem;
  }
 .register .register_header .center{
  	width: 4.61rem;
  	height: 2.81rem;
  	text-align: center;
  	line-height: 2.81rem;
  	font-size: 1.12rem;
    color: #72463d;
  }
  .block{
  	width: 0.62rem;
  }
  
  
    .register_form{
  	box-sizing: border-box;
  	width:100%;
  	height: 14.93rem;
  	padding: 0 0.62rem;
   margin-top: 0.93rem;
  }
    .register_form .phoneNumber,.register_form .yanZheng,.register_form .password,.register_form .repassword{
  	width: 100%;
  	height: 2.59rem;
  	padding-left: 0.75rem;
  	box-sizing: border-box;
  }
   .register .phoneNumber{
  	background: url(../assets/phone.png) no-repeat left center;
  	background-size: 0.68rem 1.12rem;
  }
  .register_form .yanZheng{
  	background: url(../assets/yanZ.png) no-repeat left center;
  	background-size: 0.78rem 0.95rem;
  	position: relative;
  }
  .register_form .password{
  	background: url(../assets/locak.png) no-repeat left center;
  	background-size: 0.77rem 0.95rem;
  }
  .register_form .repassword{
  	background: url(../assets/sure.png) no-repeat left center;
  	background-size: 0.77rem 0.95rem;
  }
  .register input{
  	display: block;
  	border: none;
  	border-bottom: 0.03rem solid #c1c1c1;
  	width: 100%;
  	height: 2.59rem;
  	background: #f8f8f8;
  	padding-left: 1.25rem;
  	box-sizing: border-box;
  }
    #register_phone::-webkit-input-placeholder,#register_psw::-webkit-input-placeholder,#register_yanZ::-webkit-input-placeholder,#register_repsw::-webkit-input-placeholder{
  	 	color: #c6c6c6;
		font-size: 0.93rem;
		
  }
  .get_code{
  	width: 4.68rem;
  	height: 1.5rem;
  	border-radius: 0.25rem;
  	background: #f9e44b;
  	font-size: 0.75rem;
  	color: #000002;
  	position: absolute;
  	text-align: center;
  	line-height: 1.5rem;
  	top: 0.53rem;
  	right: 0;
  }
  .register_button{
  	width: 100%;
  	height: 2.03rem;
  	background: #c1c1c1;
  	text-align: center;
  	line-height: 2.03rem;
  	color: #545454;
  	font-size: 0.87rem;
  	margin-top: 1.25rem;
  	border-radius: 0.31rem;
  }
  .err_num{
	  position: absolute;
	  top: 15rem;
	  left: 7rem;
	  height: 3.3375rem;
	  line-height: 3.3375rem;
	  text-align: center;
	  font-size: 0.3rem;
	  border-radius: .4125rem;
	  width: 9.5625rem;
	  background: rgba(0, 0, 0, .8);
	  color: #ffffff;
	  
  }
  .to_login{
  	width: 6.75rem;
  	height: 1.71rem;
  	margin: 0 auto;
  	text-align: center;
  	line-height: 1.71rem;
  	color: #f94b4c;
  	font-size: 0.68rem;
  }
</style>

